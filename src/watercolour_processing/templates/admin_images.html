{% extends "base.html" %}
{% block content %}

<!-- Title and pagination at top -->
<div class="d-flex justify-content-between align-items-center mb-3">
  <div>
    <h4 class="m-0">Images</h4>
    <small>Page {{ page }} of {{ total_pages }} (Total: {{ total_count }})</small>
  </div>
  <div>
    <a class="btn btn-sm btn-outline-primary {% if page <= 1 %}disabled{% endif %}"
       href="{% if page > 1 %}?filename={{ filename_filter }}&date_from={{ date_from }}&date_to={{ date_to }}&page={{ page-1 }}&per_page={{ per_page }}{% else %}#{% endif %}">
      Prev
    </a>
    <a class="btn btn-sm btn-outline-primary {% if page >= total_pages %}disabled{% endif %}"
       href="{% if page < total_pages %}?filename={{ filename_filter }}&date_from={{ date_from }}&date_to={{ date_to }}&page={{ page+1 }}&per_page={{ per_page }}{% else %}#{% endif %}">
      Next
    </a>
  </div>
</div>

<!-- Filter form -->
<form method="GET" class="row g-3 mb-3">
  <div class="col-auto">
    <label for="filename" class="form-label">Filename</label>
    <input type="text" class="form-control" name="filename" value="{{ filename_filter }}" id="filename"/>
  </div>
  <div class="col-auto">
    <label for="date_from" class="form-label">Date From</label>
    <input type="text" class="form-control" name="date_from" value="{{ date_from }}" id="date_from"/>
  </div>
  <div class="col-auto">
    <label for="date_to" class="form-label">Date To</label>
    <input type="text" class="form-control" name="date_to" value="{{ date_to }}" id="date_to"/>
  </div>
  <div class="col-auto" style="margin-top: 2rem;">
    <button type="submit" class="btn btn-primary">Filter</button>
  </div>
</form>

{% if images and images|length > 0 %}
  <div class="table-responsive">
    <table class="table table-striped align-middle">
      <thead>
        <tr>
          <th>ID</th>
          <th>Filename</th>
          <th>Date Taken</th>
          <th>Thumbnail</th>
        </tr>
      </thead>
      <tbody>
      {% for img in images %}
        <tr>
          <td>
            <a href="{{ url_for('admin_image_detail',
                                 image_id=img[0],
                                 filename=filename_filter,
                                 date_from=date_from,
                                 date_to=date_to,
                                 page=page,
                                 per_page=per_page) }}">
              {{ img[0] }}
            </a>
          </td>
          <td>{{ img[1] }}</td>
          <td>{{ img[3] }}</td>
          <td>
            <!-- Clickable thumbnail -->
            <a href="{{ url_for('admin_image_detail',
                                 image_id=img[0],
                                 filename=filename_filter,
                                 date_from=date_from,
                                 date_to=date_to,
                                 page=page,
                                 per_page=per_page) }}">
              <img 
                src="{{ url_for('admin_thumbnail', image_id=img[0]) }}"
                style="max-width: 100px;"
                class="img-thumbnail"
              />
            </a>
          </td>
        </tr>
      {% endfor %}
      </tbody>
    </table>
  </div>
{% else %}
  <div class="alert alert-secondary">No images found or DB is empty.</div>
{% endif %}

<div class="mt-3">
  <a class="btn btn-secondary" href="{{ url_for('admin_dashboard') }}">Back to Admin</a>
</div>
{% endblock %}
